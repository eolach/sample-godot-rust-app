# Setup Rust project

Rust source can be compiled into binaries (`bin`), Rust crates/libraries (`lib`), dynamic libraries (`dylib`) and/or static libraries (`staticlib`), etc. This can defined as the `crate-type` field value in a Cargo project configuration file.

```toml
[lib]
crate-type = ["bin", "lib"]
```

The minimal goal is to create a single dynamic system Rust/GDNative library (`cdylib`) for Godot. Using a single Cargo library project is the easiest way to go.

Optionally, if interested into splitting the whole codebase into multiple smaller, isolated and more readable libraries, using a [Cargo workspace](https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html) is the way to go. This allows to have one single centralized dynamic system Rust/GDNative library which may import and use some methods from soon-to-be created Rust libraries, for math stuff for example.

Choose and follow one of the two setup guides.

## Single Cargo library

Use the following command to create a new Cargo library project inside the Godot project directory.

```bash
cargo init --lib
```

This usually generates a `Cargo.toml` Cargo project configuration file and a `src` directory with a "_Hello World_" program inside a `lib.rs` file.

Add the `gdnative` crate dependency in the `Cargo.toml` and define the build output as a dynamic system library.

```toml
[lib]
crate-type = ["cdylib"]

[dependencies]
gdnative = "0.8"
```

## Cargo workspace

Just create a `Cargo.toml` at the root of the GOdot project and reference the soon-to-be created Cargo libraries as workspace members. The value can be an array with specific library paths. For the sake of simplicity, just create a `src` directory and define any sub-directory as a workspace member.

```
[workspace]
members = ["src/*"]
```

Then create any new Cargo project inside `src` directory by using the following command :

```bash
# Create a library called "my_lib"
cargo new src/my_lib --lib
```

The file structure should now look like this :

```
.
├─── src
│   └───  my_lib
│       ├─── src
│       │   └   lib.rs
│       └   Cargo.toml
└   Cargo.toml
```

Inside each member's `Cargo.toml` file, set accordingly the `crate-type` value with `lib` and/or `cdylib`, and add the `gdnative` dependency where it is useful.

```toml
[lib]
crate-type = [
    "cdylib", # For GDNative
    "lib"     # For Rust
]

[dependencies]
gdnative = "0.8"
```

To import some newly created library public methods in another crate, add the library as a crate dependency in `Cargo.toml`.

```toml
[dependencies]
my_lib = { path = "../my_lib" }
```

<br></br>

Finally, register the following entries in `.gitignore` and then follow the next chapter to setup the Rust/GDNative library.

```bash
# Generated by Cargo
# will have compiled files and executables
/target/

# Remove Cargo.lock from gitignore if creating an executable, leave it for libraries
# More information here https://doc.rust-lang.org/cargo/guide/cargo-toml-vs-cargo-lock.html
Cargo.lock

# These are backup files generated by rustfmt
**/*.rs.bk
```